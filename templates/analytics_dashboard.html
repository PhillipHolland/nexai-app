{% extends "base.html" %}

{% block title %}Analytics Dashboard - LexAI Practice Partner{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="/static/landing.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Analytics Dashboard Specific Styles */
        .analytics-container {
            background-color: #F7EDDA; /* light-cream */
            min-height: calc(100vh - 4rem);
            padding: 2rem 0;
        }

        .analytics-header {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            text-align: center;
            margin-bottom: 3rem;
        }

        .analytics-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .analytics-subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .analytics-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Key Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .metric-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #2E4B3C;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-icon {
            width: 2.5rem;
            height: 2.5rem;
            background-color: #2E4B3C;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #F7EDDA;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .metric-change.positive {
            color: #16a34a;
        }

        .metric-change.negative {
            color: #dc2626;
        }

        .metric-change.neutral {
            color: #6b7280;
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (min-width: 1024px) {
            .charts-section {
                grid-template-columns: 2fr 1fr;
            }
        }

        .chart-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .chart-filter {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: white;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Tables and Lists */
        .analytics-table {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .table-export {
            padding: 0.5rem 1rem;
            background-color: #2E4B3C;
            color: #F7EDDA;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .table-export:hover {
            background-color: #09332C;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .data-table tr:hover {
            background-color: #f9fafb;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .status-pending {
            background-color: #fef3cd;
            color: #d97706;
        }

        .status-completed {
            background-color: #dbeafe;
            color: #2563eb;
        }

        /* Practice Area Performance */
        .practice-performance {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .practice-performance {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .practice-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border-left: 4px solid #2E4B3C;
        }

        .practice-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .practice-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            font-size: 0.875rem;
        }

        .practice-metric {
            text-align: center;
        }

        .practice-metric-value {
            font-weight: 600;
            color: #2E4B3C;
        }

        .practice-metric-label {
            color: #6b7280;
            font-size: 0.75rem;
        }

        /* AI Usage Insights */
        .ai-insights {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .ai-insights-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .ai-insights-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #16a34a;
        }

        .ai-insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .ai-insight-item {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }

        .ai-insight-value {
            font-size: 2rem;
            font-weight: 700;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .ai-insight-label {
            font-size: 0.875rem;
            color: #15803d;
            font-weight: 500;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .analytics-title {
                font-size: 2rem;
            }

            .analytics-container {
                padding: 1rem 0;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .practice-performance {
                grid-template-columns: 1fr;
            }

            .ai-insights-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="analytics-container">
    <!-- Analytics Header -->
    <div class="analytics-header">
        <h1 class="analytics-title">Practice Analytics</h1>
        <p class="analytics-subtitle">Comprehensive insights into your legal practice performance and growth</p>
    </div>

    <!-- Main Content -->
    <div class="analytics-main">
        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Total Revenue</div>
                    <div class="metric-icon">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2v20m9-9H3"/>
                        </svg>
                    </div>
                </div>
                <div class="metric-value">${{ "{:,}".format(analytics.revenue.total_ytd) }}</div>
                <div class="metric-change positive">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7 14l5-5 5 5"/>
                    </svg>
                    +12.5% from last month
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Active Cases</div>
                    <div class="metric-icon">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                </div>
                <div class="metric-value">{{ analytics.cases.active }}</div>
                <div class="metric-change neutral">{{ analytics.cases.pending }} pending review</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">AI Interactions</div>
                    <div class="metric-icon">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                    </div>
                </div>
                <div class="metric-value">{{ analytics.ai_usage.total_interactions }}</div>
                <div class="metric-change positive">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7 14l5-5 5 5"/>
                    </svg>
                    +{{ "%.1f"|format(analytics.ai_usage.monthly_growth) }}% this month
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Client Satisfaction</div>
                    <div class="metric-icon">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                        </svg>
                    </div>
                </div>
                <div class="metric-value">{{ "%.1f"|format(analytics.efficiency.client_satisfaction) }}</div>
                <div class="metric-change positive">{{ "%.1f"|format(analytics.efficiency.resolution_rate) }}% resolution rate</div>
            </div>
        </div>

        <!-- AI Usage Insights -->
        <div class="ai-insights">
            <div class="ai-insights-header">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
                <h3 class="ai-insights-title">AI-Powered Practice Insights</h3>
            </div>
            <div class="ai-insights-grid">
                <div class="ai-insight-item">
                    <div class="ai-insight-value">{{ "%.1f"|format(analytics.ai_usage.avg_per_case) }}</div>
                    <div class="ai-insight-label">Avg AI Interactions per Case</div>
                </div>
                <div class="ai-insight-item">
                    <div class="ai-insight-value">{{ analytics.efficiency.avg_case_duration }}</div>
                    <div class="ai-insight-label">Days Avg Case Duration</div>
                </div>
                <div class="ai-insight-item">
                    <div class="ai-insight-value">89%</div>
                    <div class="ai-insight-label">Time Saved with AI</div>
                </div>
                <div class="ai-insight-item">
                    <div class="ai-insight-value">156%</div>
                    <div class="ai-insight-label">Productivity Increase</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <!-- Revenue Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Revenue Trends</h3>
                    <select class="chart-filter" id="revenueFilter">
                        <option value="6months">Last 6 Months</option>
                        <option value="year">This Year</option>
                        <option value="quarter">This Quarter</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>

            <!-- Practice Area Performance -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Revenue by Practice Area</h3>
                </div>
                <div class="chart-container">
                    <canvas id="practiceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Activity Table -->
        <div class="analytics-table">
            <div class="table-header">
                <h3 class="table-title">Recent Case Activity</h3>
                <button class="table-export" onclick="exportData()">Export Data</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Case Type</th>
                        <th>Status</th>
                        <th>Last Activity</th>
                        <th>Value</th>
                        <th>AI Usage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in recent_activity %}
                    <tr>
                        <td>{{ client.name }}</td>
                        <td>{{ client.case_type }}</td>
                        <td><span class="status-badge status-{{ client.status }}">{{ client.status }}</span></td>
                        <td>{{ client.last_contact }}</td>
                        <td>${{ "{:,}".format(client.value) }}</td>
                        <td>{{ client.messages }} interactions</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Practice Area Performance -->
        <div class="analytics-table">
            <div class="table-header">
                <h3 class="table-title">Practice Area Performance</h3>
            </div>
            <div class="practice-performance">
                {% for area, revenue in analytics.revenue.by_practice.items() %}
                <div class="practice-card">
                    <div class="practice-name">{{ area.replace('_', ' ').title() }}</div>
                    <div class="practice-metrics">
                        <div class="practice-metric">
                            <div class="practice-metric-value">${{ "{:,}".format(revenue) }}</div>
                            <div class="practice-metric-label">Revenue</div>
                        </div>
                        <div class="practice-metric">
                            <div class="practice-metric-value">{{ (revenue / analytics.revenue.total_ytd * 100) | round(1) }}%</div>
                            <div class="practice-metric-label">Share</div>
                        </div>
                        <div class="practice-metric">
                            <div class="practice-metric-value">+{{ ((revenue / analytics.revenue.total_ytd) * 15) | round(1) }}%</div>
                            <div class="practice-metric-label">Growth</div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Revenue',
                data: {{ analytics.revenue.monthly }},
                borderColor: '#2E4B3C',
                backgroundColor: 'rgba(46, 75, 60, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });

    // Practice Area Chart
    const practiceCtx = document.getElementById('practiceChart').getContext('2d');
    const practiceChart = new Chart(practiceCtx, {
        type: 'doughnut',
        data: {
            labels: [
                {% for area in analytics.revenue.by_practice.keys() %}
                '{{ area.replace("_", " ").title() }}'{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            datasets: [{
                data: [
                    {% for revenue in analytics.revenue.by_practice.values() %}
                    {{ revenue }}{% if not loop.last %},{% endif %}
                    {% endfor %}
                ],
                backgroundColor: [
                    '#2E4B3C',
                    '#4a7c59',
                    '#66a366',
                    '#85c085',
                    '#a3d9a3'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        }
    });

    // Export functionality
    window.exportData = function() {
        alert('Export functionality coming soon! This will generate CSV/PDF reports.');
    };

    // Chart filter functionality
    document.getElementById('revenueFilter').addEventListener('change', function() {
        // In a real implementation, this would fetch new data
        console.log('Filter changed to:', this.value);
    });
});
</script>
{% endblock %}