<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LexAI Practice Partner{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    
    <!-- Google Analytics -->
    {% if google_analytics_id %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ google_analytics_id }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ google_analytics_id }}');
        
        // Custom event tracking functions
        function trackEvent(action, category, label, value) {
            gtag('event', action, {
                event_category: category,
                event_label: label,
                value: value
            });
        }
        
        // Track page-specific events
        function trackPageView(pageName) {
            gtag('event', 'page_view', {
                page_title: pageName,
                page_location: window.location.href
            });
        }
        
        // Track user interactions
        function trackUserAction(action, details) {
            gtag('event', 'user_interaction', {
                event_category: 'engagement',
                event_label: action,
                custom_parameter: details
            });
        }
    </script>
    {% endif %}
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/landing.css?v={{ cache_buster }}">
    
    <!-- Authentication and User Menu Styles -->
    <style>
        .base-user-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #2E4B3C, #4a7c59);
            color: #F7EDDA;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .base-user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(46, 75, 60, 0.3);
        }

        .base-user-dropdown {
            right: 0;
            min-width: 280px;
            padding: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .base-user-info {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .base-user-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .base-user-email {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .base-user-divider {
            height: 1px;
            background: #f3f4f6;
            margin: 0.5rem 0;
        }

        .base-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #374151;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .base-dropdown-item:hover {
            background-color: #f9fafb;
            color: #1f2937;
            text-decoration: none;
        }

        .base-dropdown-item svg {
            width: 1rem;
            height: 1rem;
            color: #6b7280;
        }

        .base-dropdown-item:hover svg {
            color: #2E4B3C;
        }

        /* Mobile responsiveness for user menu */
        @media (max-width: 768px) {
            .base-user-dropdown {
                min-width: 260px;
                right: -1rem;
            }
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Header Navigation -->
    <header class="base-navbar">
        <div class="base-nav-container">
            <div class="base-nav-content">
                <!-- Logo -->
                <div>
                    {% if session.logged_in %}
                        <a href="{{ url_for('dashboard') }}">
                    {% else %}
                        <a href="{{ url_for('landing_page') }}">
                    {% endif %}
                        <img src="/static/lexAI.png" alt="LexAI" style="height: 3rem; width: auto;">
                    </a>
                </div>
                
                <!-- Streamlined Legal Navigation - 4 Core Categories -->
                <nav class="base-nav-main">
                    <!-- Dashboard -->
                    <a href="{{ url_for('dashboard') }}" 
                       class="base-nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
                        Dashboard
                    </a>
                    
                    <!-- Cases & Clients -->
                    <div class="base-dropdown">
                        <button class="base-dropdown-button">
                            Cases & Clients
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="base-dropdown-menu">
                            <a href="{{ url_for('cases_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h1a1 1 0 001-1V3a2 2 0 012 2v6h-2V8a1 1 0 10-2 0v3H4V5z" clip-rule="evenodd"/>
                                </svg>
                                All Cases
                            </a>
                            <a href="{{ url_for('clients_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                Client Directory
                            </a>
                            <a href="{{ url_for('deadlines_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                Deadlines
                            </a>
                            <a href="{{ url_for('calendar_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                                </svg>
                                Calendar
                            </a>
                        </div>
                    </div>
                    
                    <!-- Documents & AI -->
                    <div class="base-dropdown">
                        <button class="base-dropdown-button">
                            Documents & AI
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="base-dropdown-menu">
                            <a href="{{ url_for('documents_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h10l6-6V8l-6-6H6zm7 7V3.5L18.5 9H13z"/>
                                </svg>
                                Document Library
                            </a>
                            <a href="{{ url_for('document_analysis_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                AI Document Analysis
                            </a>
                            <a href="{{ url_for('contracts_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8l6-6V4c0-1.1-.9-2-2-2zm4 18l-6 6H6c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h8l6 6v12z"/>
                                </svg>
                                Contract Generator
                            </a>
                            <a href="{{ url_for('legal_research_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                                Legal Research
                            </a>
                            <a href="{{ url_for('chat_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                </svg>
                                AI Legal Assistant
                            </a>
                        </div>
                    </div>
                    
                    <!-- Operations -->
                    <div class="base-dropdown">
                        <button class="base-dropdown-button">
                            Operations
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="base-dropdown-menu">
                            <a href="{{ url_for('time_tracking_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                                    <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                </svg>
                                Time Tracking
                            </a>
                            <a href="{{ url_for('billing_page') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                                </svg>
                                Billing & Invoicing
                            </a>
                            <a href="{{ url_for('analytics_dashboard') }}" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                                </svg>
                                Reports & Analytics
                            </a>
                        </div>
                    </div>
                    
                    <!-- Settings -->
                    <div class="base-dropdown">
                        <button class="base-dropdown-button">
                            Settings
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="base-dropdown-menu">
                            <a href="/admin/users" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 4.354a4 4 0 110 6.292 4 4 0 010-6.292zM15 8a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/>
                                </svg>
                                User Management
                            </a>
                            <a href="/admin/settings" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Firm Settings
                            </a>
                            <a href="/admin/subscriptions" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                </svg>
                                Subscriptions
                            </a>
                            <a href="/admin/audit-logs" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                </svg>
                                Audit Logs
                            </a>
                        </div>
                    </div>
                </nav>
                
                <!-- User Menu -->
                <div class="base-user-menu">
                    <!-- Notifications -->
                    <button class="base-notification-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6a2 2 0 012 2v9a2 2 0 01-2 2H9l-3-3V9a2 2 0 012-2z"></path>
                        </svg>
                    </button>
                    
                    <!-- User Profile Dropdown -->
                    <div class="base-dropdown">
                        <button class="base-user-avatar" id="userMenuButton">
                            <span id="userInitials">DU</span>
                        </button>
                        <div class="base-dropdown-menu base-user-dropdown hidden">
                            <div class="base-user-info">
                                <div class="base-user-name" id="userName">Demo User</div>
                                <div class="base-user-email" id="userEmail">demo@lexai.com</div>
                            </div>
                            <div class="base-user-divider"></div>
                            <a href="/profile" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                Account Settings
                            </a>
                            <a href="#" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Preferences
                            </a>
                            <a href="#" class="base-dropdown-item">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Help & Support
                            </a>
                            <div class="base-user-divider"></div>
                            <button class="base-dropdown-item" onclick="handleLogout()" style="width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1rem; cursor: pointer;">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                </svg>
                                Sign Out
                            </button>
                        </div>
                    </div>
                    
                    <!-- Mobile menu button -->
                    <button id="mobile-menu-button" class="base-mobile-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation - UNIVERSAL FOR ALL USERS -->
        <div id="mobile-menu" class="base-mobile-menu hidden">
            <div class="base-mobile-nav">
                <!-- Dashboard -->
                <a href="{{ url_for('dashboard') }}" 
                   class="base-mobile-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
                    üè† Dashboard
                </a>
                
                <!-- Matter Management -->
                <a href="{{ url_for('cases_page') }}" 
                   class="base-mobile-link {% if request.endpoint in ['cases_page', 'case_detail'] %}active{% endif %}">
                    ‚öñÔ∏è Matter Management
                </a>
                
                <!-- Client Portal -->
                <a href="{{ url_for('clients_page') }}" 
                   class="base-mobile-link {% if request.endpoint in ['clients_page', 'client_detail'] %}active{% endif %}">
                    üë• Client Portal
                </a>
                
                <!-- Document Center -->
                <a href="{{ url_for('documents_page') }}" 
                   class="base-mobile-link {% if request.endpoint in ['documents_page', 'document_analysis_page'] %}active{% endif %}">
                    üìÑ Document Center
                </a>
                
                <!-- Calendar & Deadlines -->
                <a href="{{ url_for('calendar_page') }}" 
                   class="base-mobile-link {% if request.endpoint in ['calendar_page', 'deadlines_page'] %}active{% endif %}">
                    üìÖ Calendar & Deadlines
                </a>
                
                <!-- Time Entry -->
                <a href="{{ url_for('time_tracking_page') }}" 
                   class="base-mobile-link {% if request.endpoint == 'time_tracking_page' %}active{% endif %}">
                    ‚è±Ô∏è Time Entry
                </a>
                
                <!-- Billing Center -->
                <a href="{{ url_for('billing_page') }}" 
                   class="base-mobile-link {% if request.endpoint in ['billing_page', 'expense_tracking_page'] %}active{% endif %}">
                    üí∞ Billing Center
                </a>
                
                <!-- Reports & Analytics -->
                <a href="{{ url_for('analytics_dashboard') }}" 
                   class="base-mobile-link {% if request.endpoint == 'analytics_dashboard' %}active{% endif %}">
                    üìä Reports & Analytics
                </a>
                
                <!-- AI Tools -->
                <a href="{{ url_for('chat_page') }}" 
                   class="base-mobile-link {% if request.endpoint == 'chat_page' %}active{% endif %}">
                    ü§ñ AI Legal Assistant
                </a>
                <a href="{{ url_for('document_analysis_page') }}" 
                   class="base-mobile-link {% if request.endpoint == 'document_analysis_page' %}active{% endif %}">
                    üìä Document Analysis
                </a>
                <a href="{{ url_for('legal_research_page') }}" 
                   class="base-mobile-link {% if request.endpoint == 'legal_research_page' %}active{% endif %}">
                    üîç Legal Research
                </a>
                <a href="{{ url_for('contracts_page') }}" 
                   class="base-mobile-link {% if request.endpoint == 'contracts_page' %}active{% endif %}">
                    üìù Contract Generator
                </a>
                
                <!-- Firm Management -->
                <a href="/admin/users" 
                   class="base-mobile-link">
                    üë• User Management
                </a>
                <a href="/admin/settings" 
                   class="base-mobile-link">
                    ‚öôÔ∏è Firm Settings
                </a>
                <a href="/admin/subscriptions" 
                   class="base-mobile-link">
                    üí≥ Subscriptions
                </a>
                <a href="/admin/audit-logs" 
                   class="base-mobile-link">
                    üìã Audit Logs
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="base-footer">
        <div class="base-footer-container">
            <div class="base-footer-content">
                ¬© 2025 LexAI Practice Partner. Professional AI assistant for legal practices.
            </div>
        </div>
    </footer>

    <!-- Base JavaScript -->
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

        // Authentication and user session management
        function loadUserInfo() {
            try {
                const authData = localStorage.getItem('lexai_auth');
                if (authData) {
                    const auth = JSON.parse(authData);
                    if (auth.user) {
                        const user = auth.user;
                        const firstName = user.first_name || 'Demo';
                        const lastName = user.last_name || 'User';
                        const email = user.email || 'demo@lexai.com';
                        
                        // Update user info in UI
                        document.getElementById('userName').textContent = `${firstName} ${lastName}`;
                        document.getElementById('userEmail').textContent = email;
                        document.getElementById('userInitials').textContent = 
                            `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();
                    }
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        // Logout functionality
        window.handleLogout = async function() {
            try {
                // Call logout API
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();
                
                // Clear local storage
                localStorage.removeItem('lexai_auth');
                
                // Redirect to login
                window.location.href = data.redirect || '/auth/login';
            } catch (error) {
                console.error('Logout error:', error);
                // Still clear local storage and redirect
                localStorage.removeItem('lexai_auth');
                window.location.href = '/auth/login';
            }
        };

        // Check authentication status
        function checkAuthStatus() {
            const authData = localStorage.getItem('lexai_auth');
            const currentPath = window.location.pathname;
            
            // DEVELOPMENT MODE: Skip authentication check for now
            // TODO: Re-enable authentication checks in production
            /*
            if (!authData && !currentPath.startsWith('/auth/') && currentPath !== '/') {
                window.location.href = '/auth/login';
                return false;
            }
            */
            
            // If no auth data, create demo session for development
            if (!authData) {
                const demoAuth = {
                    user: {
                        first_name: 'Demo',
                        last_name: 'User',
                        email: 'demo@lexai.com',
                        firm_name: 'Demo Law Firm',
                        role: 'Legal Professional'
                    },
                    loginTime: new Date().toISOString()
                };
                localStorage.setItem('lexai_auth', JSON.stringify(demoAuth));
            }
            
            return true;
        }

        // Load user functionality
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            checkAuthStatus();
            
            // Simple click toggle for dropdowns
            document.querySelectorAll('.base-dropdown-button').forEach(function(button) {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const dropdown = this.parentElement;
                    
                    // Close all other dropdowns
                    document.querySelectorAll('.base-dropdown').forEach(function(otherDropdown) {
                        if (otherDropdown !== dropdown) {
                            otherDropdown.classList.remove('open');
                        }
                    });
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('open');
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.base-dropdown')) {
                    document.querySelectorAll('.base-dropdown').forEach(function(dropdown) {
                        dropdown.classList.remove('open');
                    });
                }
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>