<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Portal Dashboard - LexAI Practice Partner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #F7EDDA;
            line-height: 1.6;
        }
        
        /* Header */
        .portal-header {
            background: linear-gradient(135deg, #2E4B3C 0%, #1a3429 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: #F7EDDA;
        }
        
        .logo img {
            height: 2.5rem;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex: 1;
            justify-content: center;
        }
        
        .nav-links a {
            color: #F7EDDA;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
        }
        
        .nav-links a:hover {
            color: #FFA74F;
            background-color: rgba(255, 167, 79, 0.1);
        }
        
        .nav-links a.active {
            color: #FFA74F;
            font-weight: 600;
            background-color: rgba(255, 167, 79, 0.2);
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .client-name {
            font-weight: 600;
        }
        
        .logout-btn {
            background-color: #FFA74F;
            color: #2E4B3C;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .logout-btn:hover {
            background-color: #ff9d3d;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }
        
        /* Main Content */
        .portal-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .welcome-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .welcome-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .welcome-subtitle {
            color: #6b7280;
            font-size: 1rem;
        }
        
        .case-status {
            display: inline-block;
            background: #FFA74F;
            color: #2E4B3C;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 1rem;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .card-icon {
            font-size: 1.5rem;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        /* Case Summary */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2E4B3C;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        /* Activities */
        .activity-list {
            space-y: 1rem;
        }
        
        .activity-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .activity-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .activity-icon.document {
            background: #ecfdf5;
            color: #10b981;
        }
        
        .activity-icon.call {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .activity-icon.court {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .activity-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .activity-date {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        /* Deadlines */
        .deadline-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .deadline-info {
            flex: 1;
        }
        
        .deadline-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .deadline-description {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .deadline-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .deadline-badge.high {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .deadline-badge.medium {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        /* Documents */
        .document-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .document-item:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        
        .document-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            background: #ecfdf5;
            color: #10b981;
        }
        
        .document-info {
            flex: 1;
            min-width: 0;
        }
        
        .document-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .document-meta {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .document-size {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        /* Document Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: white;
            margin: 2rem auto;
            padding: 0;
            border-radius: 1rem;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #2E4B3C 0%, #1a3429 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .document-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            background: white;
            transition: all 0.2s ease;
        }
        
        .document-card:hover {
            border-color: #2E4B3C;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .document-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .document-card-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: #ecfdf5;
            color: #10b981;
        }
        
        .document-card-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
            flex: 1;
        }
        
        .document-card-description {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .document-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #9ca3af;
            margin-bottom: 1rem;
        }
        
        .document-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-download {
            background-color: #2E4B3C;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }
        
        .btn-download:hover {
            background-color: #1a3429;
            transform: translateY(-1px);
        }
        
        .btn-details {
            background-color: #f8fafc;
            color: #374151;
            border: 1px solid #e5e7eb;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-details:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }

        /* Messages */
        .message-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .message-item:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        
        .message-item.unread {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }
        
        .message-item.unread:hover {
            background: #fde68a;
        }
        
        .message-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            font-weight: 600;
        }
        
        .message-avatar.attorney {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .message-avatar.client {
            background: #ecfdf5;
            color: #10b981;
        }
        
        .message-info {
            flex: 1;
            min-width: 0;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .message-sender {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .message-subject {
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .message-preview {
            font-size: 0.75rem;
            color: #6b7280;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .message-priority {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .message-priority.high {
            background: #dc2626;
        }
        
        .message-priority.normal {
            background: #10b981;
        }
        
        .unread-badge {
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        /* Message Modal */
        .message-modal-content {
            max-width: 1200px;
        }
        
        .messages-container {
            display: flex;
            height: 70vh;
            overflow: hidden;
        }
        
        .messages-list {
            width: 40%;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .message-detail {
            width: 60%;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .message-list-item {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .message-list-item:hover {
            background: #f8fafc;
        }
        
        .message-list-item.selected {
            background: #dbeafe;
            border-left-color: #2563eb;
        }
        
        .message-list-item.unread {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }
        
        .message-full-content {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        
        .message-full-header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        
        .message-full-subject {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .message-full-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .message-full-body {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #374151;
        }
        
        .compose-section {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        
        .compose-header {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .compose-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .compose-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        
        .compose-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        
        .compose-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .btn-compose {
            background-color: #2E4B3C;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-compose:hover {
            background-color: #1a3429;
        }
        
        .btn-compose:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-cancel {
            background-color: #f8fafc;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-cancel:hover {
            background-color: #f3f4f6;
        }

        /* Case Progress */
        .progress-overview {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .progress-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }
        
        .progress-percentage {
            font-weight: 700;
            color: #2E4B3C;
            font-size: 1.125rem;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 0.75rem;
            background: #e5e7eb;
            border-radius: 0.375rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            border-radius: 0.375rem;
            transition: width 0.5s ease;
        }
        
        .progress-phase {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .current-phase {
            color: #374151;
            font-weight: 500;
        }
        
        .phase-status {
            color: #6b7280;
        }
        
        .milestone-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid transparent;
        }
        
        .milestone-item.completed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .milestone-item.upcoming {
            border-left-color: #f59e0b;
            background: #fefce8;
        }
        
        .milestone-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .milestone-icon.completed {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .milestone-icon.upcoming {
            background: #fef3c7;
            color: #d97706;
        }
        
        .milestone-info {
            flex: 1;
            min-width: 0;
        }
        
        .milestone-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
            margin-bottom: 0.125rem;
        }
        
        .milestone-description {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.125rem;
        }
        
        .milestone-date {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        /* Progress Modal */
        .progress-modal-content {
            max-width: 1000px;
        }
        
        .timeline-container {
            padding: 1.5rem;
        }
        
        .timeline-header {
            background: linear-gradient(135deg, #2E4B3C 0%, #1a3429 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }
        
        .timeline-case-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .timeline-progress-bar {
            width: 100%;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .timeline-progress-fill {
            height: 100%;
            background: #FFA74F;
            border-radius: 0.25rem;
            transition: width 0.5s ease;
        }
        
        .phase-section {
            margin-bottom: 2rem;
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            border-left: 4px solid transparent;
        }
        
        .phase-header.completed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .phase-header.in-progress {
            border-left-color: #f59e0b;
            background: #fefce8;
        }
        
        .phase-header.upcoming {
            border-left-color: #6b7280;
            background: #f9fafb;
        }
        
        .phase-status-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .phase-status-icon.completed {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .phase-status-icon.in-progress {
            background: #fef3c7;
            color: #d97706;
        }
        
        .phase-status-icon.upcoming {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .phase-info {
            flex: 1;
        }
        
        .phase-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .phase-description {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .phase-dates {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        
        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-left: 3.5rem;
        }
        
        .milestone-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .milestone-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .milestone-card.completed {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        
        .milestone-card.pending {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
        }
        
        .milestone-card.scheduled {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .milestone-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .milestone-type-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .milestone-card-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .milestone-card-description {
            color: #374151;
            font-size: 0.75rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }
        
        .milestone-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
        }
        
        .milestone-card-date {
            color: #6b7280;
            font-weight: 500;
        }
        
        .milestone-status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .milestone-status-badge.completed {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .milestone-status-badge.pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .milestone-status-badge.scheduled {
            background: #dbeafe;
            color: #2563eb;
        }

        /* Appointments */
        .appointment-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .appointment-item:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
        }
        
        .appointment-item.upcoming {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        
        .appointment-item.upcoming:hover {
            background: #dbeafe;
        }
        
        .appointment-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .appointment-info {
            flex: 1;
            min-width: 0;
        }
        
        .appointment-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .appointment-details {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .appointment-time {
            font-size: 0.75rem;
            color: #9ca3af;
            font-weight: 500;
        }
        
        .appointment-status {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .appointment-status.confirmed {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .appointment-status.pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* Appointments Modal */
        .appointments-modal-content {
            max-width: 1100px;
        }
        
        .appointments-container {
            display: flex;
            height: 70vh;
            overflow: hidden;
        }
        
        .appointments-sidebar {
            width: 35%;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .appointments-main {
            width: 65%;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .appointment-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .appointment-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .appointment-card.upcoming {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .appointment-card.past {
            border-color: #d1d5db;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        }
        
        .appointment-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .appointment-card-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .appointment-card-meta {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .appointment-card-details {
            margin-bottom: 0.75rem;
        }
        
        .appointment-card-notes {
            font-size: 0.875rem;
            color: #374151;
            margin-bottom: 0.75rem;
            font-style: italic;
        }
        
        .appointment-card-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-reschedule {
            background-color: #f59e0b;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-reschedule:hover {
            background-color: #d97706;
        }
        
        .btn-cancel-appointment {
            background-color: #dc2626;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-cancel-appointment:hover {
            background-color: #b91c1c;
        }
        
        /* Scheduling Form */
        .scheduling-section {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .scheduling-header {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .scheduling-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-group-full {
            grid-column: 1 / -1;
        }
        
        .scheduling-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        
        .scheduling-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: white;
        }
        
        .scheduling-textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }
        
        .available-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .time-slot {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .time-slot:hover {
            border-color: #2E4B3C;
            background: #f0fdf4;
        }
        
        .time-slot.selected {
            border-color: #2E4B3C;
            background: #2E4B3C;
            color: white;
        }
        
        .time-slot.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f3f4f6;
        }
        
        .btn-schedule {
            background-color: #2E4B3C;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            grid-column: 1 / -1;
            justify-self: start;
        }
        
        .btn-schedule:hover {
            background-color: #1a3429;
        }
        
        .btn-schedule:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: #374151;
        }
        
        .action-btn:hover {
            background: #f3f4f6;
            border-color: #2E4B3C;
            transform: translateY(-1px);
        }
        
        .action-icon {
            font-size: 1.25rem;
        }
        
        .action-title {
            font-weight: 600;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }
        
        .loading-spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #2E4B3C;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                order: 2;
            }
            
            .nav-links a {
                padding: 0.375rem 0.75rem;
                font-size: 0.875rem;
            }
            
            .header-actions {
                order: 3;
            }
            
            .portal-main {
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .welcome-section {
                padding: 1.5rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header class="portal-header">
        <div class="header-content">
            <div class="logo">
                <img src="/static/lexAI.png" alt="LexAI Practice Partner">
            </div>
            <div class="nav-links">
                <a href="/client-portal/dashboard" class="active">Dashboard</a>
                <a href="/client-portal/billing">Billing</a>
                <a href="/client-portal/messages">Messages</a>
                <a href="/client-portal/documents">Documents</a>
            </div>
            <div class="header-actions">
                <span class="client-name" id="clientName">Loading...</span>
                <button class="logout-btn" onclick="logout()">Sign Out</button>
            </div>
        </div>
    </header>

    <main class="portal-main">
        <div id="loadingState" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading your dashboard...</p>
        </div>

        <div id="dashboardContent" style="display: none;">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <h1 class="welcome-title" id="welcomeTitle">Welcome back!</h1>
                <p class="welcome-subtitle" id="welcomeSubtitle">Here's an overview of your case progress</p>
                <div class="case-status" id="caseStatus">Active Case</div>
            </section>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Case Summary -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <h2 class="card-title">Case Summary</h2>
                    </div>
                    <div class="summary-stats" id="caseSummary">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üìã</span>
                        <h2 class="card-title">Recent Activities</h2>
                    </div>
                    <div class="activity-list" id="recentActivities">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Recent Messages -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üí¨</span>
                        <h2 class="card-title">Recent Messages</h2>
                        <span id="unreadBadge" class="unread-badge" style="display: none;">0</span>
                    </div>
                    <div id="recentMessages">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button onclick="viewAllMessages()" class="action-btn" style="width: 100%; border: none; background: #f8fafc;">
                            <span class="action-icon">üì¨</span>
                            <span class="action-title">View All Messages</span>
                        </button>
                    </div>
                </div>

                <!-- Upcoming Deadlines -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">‚è∞</span>
                        <h2 class="card-title">Upcoming Deadlines</h2>
                    </div>
                    <div id="upcomingDeadlines">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Documents -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üìÑ</span>
                        <h2 class="card-title">Recent Documents</h2>
                    </div>
                    <div id="recentDocuments">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button onclick="viewAllDocuments()" class="action-btn" style="width: 100%; border: none; background: #f8fafc;">
                            <span class="action-icon">üìÇ</span>
                            <span class="action-title">View All Documents</span>
                        </button>
                    </div>
                </div>

                <!-- Case Progress -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üìà</span>
                        <h2 class="card-title">Case Progress</h2>
                    </div>
                    <div id="caseProgressOverview">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button onclick="viewDetailedProgress()" class="action-btn" style="width: 100%; border: none; background: #f8fafc;">
                            <span class="action-icon">üóìÔ∏è</span>
                            <span class="action-title">View Full Timeline</span>
                        </button>
                    </div>
                </div>

                <!-- Upcoming Appointments -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">üìÖ</span>
                        <h2 class="card-title">Upcoming Appointments</h2>
                    </div>
                    <div id="upcomingAppointments">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button onclick="viewAllAppointments()" class="action-btn" style="width: 100%; border: none; background: #f8fafc;">
                            <span class="action-icon">üóìÔ∏è</span>
                            <span class="action-title">Manage Appointments</span>
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <span class="card-icon">‚ö°</span>
                        <h2 class="card-title">Quick Actions</h2>
                    </div>
                    <div class="quick-actions" id="quickActions">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Documents Modal -->
    <div id="documentsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Documents</h2>
                <button class="modal-close" onclick="closeDocumentsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="documentsGrid" class="documents-grid">
                    <!-- Populated by JavaScript -->
                </div>
                <div id="documentsLoading" class="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Loading your documents...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Modal -->
    <div id="messagesModal" class="modal">
        <div class="modal-content message-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Messages</h2>
                <button class="modal-close" onclick="closeMessagesModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="messages-container">
                    <div class="messages-list">
                        <div id="messagesList">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div id="messagesLoading" class="loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Loading messages...</p>
                        </div>
                    </div>
                    <div class="message-detail">
                        <div id="messageDetail">
                            <p style="color: #6b7280; text-align: center; padding: 2rem;">Select a message to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Case Progress Modal -->
    <div id="progressModal" class="modal">
        <div class="modal-content progress-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Case Timeline & Progress</h2>
                <button class="modal-close" onclick="closeProgressModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="timeline-container">
                    <div id="timelineHeader">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div id="timelinePhases">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div id="progressLoading" class="loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>Loading case timeline...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointments Modal -->
    <div id="appointmentsModal" class="modal">
        <div class="modal-content appointments-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Appointments</h2>
                <button class="modal-close" onclick="closeAppointmentsModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="appointments-container">
                    <div class="appointments-sidebar">
                        <h3 style="margin-bottom: 1rem; color: #1f2937;">Your Appointments</h3>
                        <div id="appointmentsList">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div id="appointmentsLoading" class="loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Loading appointments...</p>
                        </div>
                    </div>
                    <div class="appointments-main">
                        <div id="appointmentsMainContent">
                            <!-- Default content -->
                            <div class="scheduling-section">
                                <div class="scheduling-header">üìÖ Schedule New Appointment</div>
                                <div class="scheduling-form" id="schedulingForm">
                                    <div>
                                        <label class="form-label">Appointment Type</label>
                                        <select class="scheduling-select" id="appointmentType">
                                            <option value="">Select appointment type</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">Preferred Date</label>
                                        <input type="date" class="scheduling-input" id="appointmentDate">
                                    </div>
                                    <div class="form-group-full">
                                        <label class="form-label">Available Times</label>
                                        <div id="availableSlots" class="available-slots">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                    <div class="form-group-full">
                                        <label class="form-label">Notes (Optional)</label>
                                        <textarea class="scheduling-input scheduling-textarea" id="appointmentNotes" 
                                                  placeholder="Any specific topics you'd like to discuss..."></textarea>
                                    </div>
                                    <button type="button" class="btn-schedule" id="scheduleButton" onclick="scheduleAppointment()" disabled>
                                        Schedule Appointment
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load dashboard data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        async function loadDashboard() {
            try {
                const response = await fetch('/api/client-portal/dashboard');
                const data = await response.json();

                if (data.success) {
                    renderDashboard(data.dashboard);
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = '/client-portal/login';
                }
            } catch (error) {
                console.error('Dashboard load error:', error);
                document.getElementById('loadingState').innerHTML = `
                    <p style="color: #dc2626;">Error loading dashboard. Please refresh the page.</p>
                `;
            }
        }

        function renderDashboard(dashboard) {
            // Update header
            document.getElementById('clientName').textContent = dashboard.client_info.name;
            
            // Update welcome section
            document.getElementById('welcomeTitle').textContent = `Welcome back, ${dashboard.client_info.name}!`;
            document.getElementById('welcomeSubtitle').textContent = `${dashboard.client_info.case_type} ‚Ä¢ Attorney: ${dashboard.client_info.attorney_name}`;
            document.getElementById('caseStatus').textContent = dashboard.client_info.case_status;

            // Case Summary
            const caseSummary = document.getElementById('caseSummary');
            caseSummary.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${dashboard.case_summary.active_cases}</div>
                    <div class="stat-label">Active Cases</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${dashboard.case_summary.total_documents}</div>
                    <div class="stat-label">Documents</div>
                </div>
            `;

            // Recent Activities
            const recentActivities = document.getElementById('recentActivities');
            recentActivities.innerHTML = dashboard.recent_activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${activity.type}">
                        ${getActivityIcon(activity.type)}
                    </div>
                    <div class="activity-details">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-description">${activity.description}</div>
                        <div class="activity-date">${formatDate(activity.date)}</div>
                    </div>
                </div>
            `).join('');

            // Upcoming Deadlines
            const upcomingDeadlines = document.getElementById('upcomingDeadlines');
            upcomingDeadlines.innerHTML = dashboard.upcoming_deadlines.map(deadline => `
                <div class="deadline-item">
                    <div class="deadline-info">
                        <div class="deadline-title">${deadline.title}</div>
                        <div class="deadline-description">${deadline.description}</div>
                    </div>
                    <div class="deadline-badge ${deadline.priority}">
                        ${deadline.days_until} days
                    </div>
                </div>
            `).join('');

            // Recent Documents (load separately)
            loadRecentDocuments();

            // Recent Messages (load separately)
            loadRecentMessages();

            // Case Progress (load separately)
            loadCaseProgress();

            // Upcoming Appointments (load separately)
            loadUpcomingAppointments();

            // Quick Actions
            const quickActions = document.getElementById('quickActions');
            quickActions.innerHTML = dashboard.quick_actions.map(action => `
                <a href="#" class="action-btn" onclick="handleQuickAction('${action.action}')">
                    <span class="action-icon">${action.icon}</span>
                    <span class="action-title">${action.title}</span>
                </a>
            `).join('');
        }

        function getActivityIcon(type) {
            const icons = {
                'document': 'üìÑ',
                'call': 'üìû',
                'court': '‚öñÔ∏è',
                'email': 'üìß',
                'meeting': 'ü§ù'
            };
            return icons[type] || 'üìã';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = now - date;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) {
                return 'Today';
            } else if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else {
                return date.toLocaleDateString();
            }
        }

        function handleQuickAction(action) {
            switch (action) {
                case 'documents':
                    viewAllDocuments();
                    break;
                case 'messages':
                    viewAllMessages();
                    break;
                case 'schedule':
                    viewAllAppointments();
                    break;
                case 'billing':
                    window.location.href = '/client-portal/billing';
                    break;
                default:
                    alert('Feature coming soon!');
            }
        }

        async function logout() {
            try {
                await fetch('/api/client-portal/auth/logout', {
                    method: 'POST'
                });
                window.location.href = '/client-portal/login';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/client-portal/login';
            }
        }

        // Document Management Functions
        async function loadRecentDocuments() {
            try {
                const response = await fetch('/api/client-portal/documents');
                const data = await response.json();

                if (data.success) {
                    renderRecentDocuments(data.documents.slice(0, 3)); // Show only 3 most recent
                } else {
                    document.getElementById('recentDocuments').innerHTML = 
                        '<p style="color: #6b7280; text-align: center; padding: 1rem;">No documents available</p>';
                }
            } catch (error) {
                console.error('Error loading recent documents:', error);
                document.getElementById('recentDocuments').innerHTML = 
                    '<p style="color: #dc2626; text-align: center; padding: 1rem;">Error loading documents</p>';
            }
        }

        function renderRecentDocuments(documents) {
            const recentDocuments = document.getElementById('recentDocuments');
            
            if (documents.length === 0) {
                recentDocuments.innerHTML = 
                    '<p style="color: #6b7280; text-align: center; padding: 1rem;">No recent documents</p>';
                return;
            }

            recentDocuments.innerHTML = documents.map(doc => `
                <div class="document-item" onclick="downloadDocument('${doc.id}')">
                    <div class="document-icon">
                        ${getDocumentIcon(doc.document_type)}
                    </div>
                    <div class="document-info">
                        <div class="document-title">${doc.title}</div>
                        <div class="document-meta">${doc.document_type} ‚Ä¢ ${formatDate(doc.created_at)}</div>
                        <div class="document-size">${formatFileSize(doc.file_size)}</div>
                    </div>
                </div>
            `).join('');
        }

        async function viewAllDocuments() {
            const modal = document.getElementById('documentsModal');
            const loading = document.getElementById('documentsLoading');
            const grid = document.getElementById('documentsGrid');
            
            // Show modal and loading state
            modal.style.display = 'block';
            loading.style.display = 'block';
            grid.style.display = 'none';
            
            try {
                const response = await fetch('/api/client-portal/documents');
                const data = await response.json();

                if (data.success) {
                    renderAllDocuments(data.documents);
                } else {
                    grid.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading documents</p>';
                }
            } catch (error) {
                console.error('Error loading documents:', error);
                grid.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading documents</p>';
            } finally {
                loading.style.display = 'none';
                grid.style.display = 'grid';
            }
        }

        function renderAllDocuments(documents) {
            const grid = document.getElementById('documentsGrid');
            
            if (documents.length === 0) {
                grid.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem; grid-column: 1 / -1;">No documents available</p>';
                return;
            }

            grid.innerHTML = documents.map(doc => `
                <div class="document-card">
                    <div class="document-card-header">
                        <div class="document-card-icon">
                            ${getDocumentIcon(doc.document_type)}
                        </div>
                        <div class="document-card-title">${doc.title}</div>
                    </div>
                    <div class="document-card-description">${doc.description || 'No description available'}</div>
                    <div class="document-card-meta">
                        <span>${doc.document_type}</span>
                        <span>${formatFileSize(doc.file_size)}</span>
                        <span>${formatDate(doc.created_at)}</span>
                    </div>
                    <div class="document-card-actions">
                        <button class="btn-download" onclick="downloadDocument('${doc.id}')">
                            üì• Download
                        </button>
                        <button class="btn-details" onclick="viewDocumentDetails('${doc.id}')">
                            ‚ÑπÔ∏è Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function downloadDocument(documentId) {
            try {
                const response = await fetch(`/api/client-portal/documents/${documentId}/download`);
                const data = await response.json();

                if (data.success) {
                    // In a real implementation, this would trigger the actual file download
                    // For now, show a success message
                    alert(`Download initiated for: ${data.download_info.filename}\nFile size: ${formatFileSize(data.download_info.file_size)}`);
                } else {
                    alert('Error: ' + (data.error || 'Unable to download document'));
                }
            } catch (error) {
                console.error('Download error:', error);
                alert('Error downloading document. Please try again.');
            }
        }

        async function viewDocumentDetails(documentId) {
            try {
                const response = await fetch(`/api/client-portal/documents/${documentId}`);
                const data = await response.json();

                if (data.success) {
                    const doc = data.document;
                    let versionsText = doc.versions.length > 0 ? 
                        `\n\nVersions: ${doc.versions.map(v => v.version).join(', ')}` : '';
                    
                    alert(`Document Details:\n\nTitle: ${doc.title}\nType: ${doc.document_type}\nStatus: ${doc.status}\nVersion: ${doc.version}\nCreated: ${formatDate(doc.created_at)}\nSize: ${formatFileSize(doc.file_size)}${versionsText}\n\nDescription:\n${doc.description || 'No description available'}`);
                } else {
                    alert('Error: ' + (data.error || 'Unable to load document details'));
                }
            } catch (error) {
                console.error('Details error:', error);
                alert('Error loading document details. Please try again.');
            }
        }

        function closeDocumentsModal() {
            document.getElementById('documentsModal').style.display = 'none';
        }

        function getDocumentIcon(documentType) {
            const icons = {
                'Court Filing': '‚öñÔ∏è',
                'Legal Form': 'üìã',
                'Contract': 'üìÑ',
                'Court Notice': 'üì¢',
                'Legal Brief': 'üìë',
                'Agreement': 'ü§ù',
                'Motion': '‚öñÔ∏è',
                'Pleading': 'üìú'
            };
            return icons[documentType] || 'üìÑ';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Message Management Functions
        async function loadRecentMessages() {
            try {
                const response = await fetch('/api/client-portal/messages');
                const data = await response.json();

                if (data.success) {
                    renderRecentMessages(data.messages.slice(0, 3), data.unread_count); // Show only 3 most recent
                } else {
                    document.getElementById('recentMessages').innerHTML = 
                        '<p style="color: #6b7280; text-align: center; padding: 1rem;">No messages available</p>';
                }
            } catch (error) {
                console.error('Error loading recent messages:', error);
                document.getElementById('recentMessages').innerHTML = 
                    '<p style="color: #dc2626; text-align: center; padding: 1rem;">Error loading messages</p>';
            }
        }

        function renderRecentMessages(messages, unreadCount) {
            const recentMessages = document.getElementById('recentMessages');
            const unreadBadge = document.getElementById('unreadBadge');
            
            // Update unread badge
            if (unreadCount > 0) {
                unreadBadge.textContent = unreadCount;
                unreadBadge.style.display = 'flex';
            } else {
                unreadBadge.style.display = 'none';
            }
            
            if (messages.length === 0) {
                recentMessages.innerHTML = 
                    '<p style="color: #6b7280; text-align: center; padding: 1rem;">No recent messages</p>';
                return;
            }

            recentMessages.innerHTML = messages.map(msg => `
                <div class="message-item ${!msg.is_read ? 'unread' : ''}" onclick="openMessage('${msg.id}')">
                    <div class="message-avatar ${msg.sender}">
                        ${msg.sender === 'attorney' ? 'SJ' : 'JS'}
                    </div>
                    <div class="message-info">
                        <div class="message-header">
                            <span class="message-sender">${msg.sender_name}</span>
                            <span class="message-time">${formatDate(msg.timestamp)}</span>
                        </div>
                        <div class="message-subject">${msg.subject}</div>
                        <div class="message-preview">${msg.content.substring(0, 100)}...</div>
                    </div>
                    <div class="message-priority ${msg.priority}"></div>
                </div>
            `).join('');
        }

        async function viewAllMessages() {
            const modal = document.getElementById('messagesModal');
            const loading = document.getElementById('messagesLoading');
            const messagesList = document.getElementById('messagesList');
            
            // Show modal and loading state
            modal.style.display = 'block';
            loading.style.display = 'block';
            messagesList.style.display = 'none';
            
            try {
                const response = await fetch('/api/client-portal/messages');
                const data = await response.json();

                if (data.success) {
                    renderAllMessages(data.messages);
                } else {
                    messagesList.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading messages</p>';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
                messagesList.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading messages</p>';
            } finally {
                loading.style.display = 'none';
                messagesList.style.display = 'block';
            }
        }

        function renderAllMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            
            if (messages.length === 0) {
                messagesList.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem;">No messages available</p>';
                return;
            }

            messagesList.innerHTML = messages.map(msg => `
                <div class="message-list-item ${!msg.is_read ? 'unread' : ''}" onclick="selectMessage('${msg.id}')">
                    <div class="message-header">
                        <span class="message-sender">${msg.sender_name}</span>
                        <span class="message-time">${formatDate(msg.timestamp)}</span>
                    </div>
                    <div class="message-subject">${msg.subject}</div>
                    <div class="message-preview">${msg.content.substring(0, 80)}...</div>
                </div>
            `).join('');
        }

        async function selectMessage(messageId) {
            // Update selection UI
            document.querySelectorAll('.message-list-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Load message details
            try {
                const response = await fetch(`/api/client-portal/messages/${messageId}`);
                const data = await response.json();

                if (data.success) {
                    renderMessageDetail(data.message);
                    
                    // Mark as read if unread
                    if (!data.message.is_read) {
                        markMessageAsRead(messageId);
                        event.currentTarget.classList.remove('unread');
                    }
                } else {
                    document.getElementById('messageDetail').innerHTML = 
                        '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading message details</p>';
                }
            } catch (error) {
                console.error('Error loading message details:', error);
                document.getElementById('messageDetail').innerHTML = 
                    '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading message details</p>';
            }
        }

        function renderMessageDetail(message) {
            const messageDetail = document.getElementById('messageDetail');
            
            messageDetail.innerHTML = `
                <div class="message-full-content">
                    <div class="message-full-header">
                        <div class="message-full-subject">${message.subject}</div>
                        <div class="message-full-meta">
                            <span>From: ${message.sender_name}</span>
                            <span>${formatDate(message.timestamp)}</span>
                        </div>
                    </div>
                    <div class="message-full-body">${message.content}</div>
                </div>
                
                <div class="compose-section">
                    <div class="compose-header">Reply</div>
                    <div class="compose-form">
                        <input type="text" class="compose-input" id="replySubject" 
                               placeholder="Subject" value="Re: ${message.subject}">
                        <textarea class="compose-input compose-textarea" id="replyContent" 
                                  placeholder="Type your reply..."></textarea>
                        <div class="compose-actions">
                            <button type="button" class="btn-cancel" onclick="clearReply()">Cancel</button>
                            <button type="button" class="btn-compose" onclick="sendReply('${message.id}')">Send Reply</button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function sendReply(originalMessageId) {
            const subject = document.getElementById('replySubject').value.trim();
            const content = document.getElementById('replyContent').value.trim();
            
            if (!content) {
                alert('Please enter a message before sending.');
                return;
            }
            
            const sendButton = document.querySelector('.btn-compose');
            sendButton.disabled = true;
            sendButton.textContent = 'Sending...';
            
            try {
                const response = await fetch('/api/client-portal/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subject: subject,
                        content: content,
                        reply_to: originalMessageId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Reply sent successfully!');
                    clearReply();
                    // Refresh messages
                    viewAllMessages();
                    loadRecentMessages();
                } else {
                    alert('Error: ' + (data.error || 'Failed to send reply'));
                }
            } catch (error) {
                console.error('Error sending reply:', error);
                alert('Error sending reply. Please try again.');
            } finally {
                sendButton.disabled = false;
                sendButton.textContent = 'Send Reply';
            }
        }

        function clearReply() {
            document.getElementById('replySubject').value = '';
            document.getElementById('replyContent').value = '';
        }

        async function markMessageAsRead(messageId) {
            try {
                await fetch(`/api/client-portal/messages/${messageId}/read`, {
                    method: 'POST'
                });
                // Refresh unread count
                loadRecentMessages();
            } catch (error) {
                console.error('Error marking message as read:', error);
            }
        }

        async function openMessage(messageId) {
            await viewAllMessages();
            // Small delay to ensure modal is open before selecting message
            setTimeout(() => {
                const messageItem = document.querySelector(`[onclick="selectMessage('${messageId}')"]`);
                if (messageItem) {
                    messageItem.click();
                }
            }, 100);
        }

        function closeMessagesModal() {
            document.getElementById('messagesModal').style.display = 'none';
        }

        // Case Progress Management Functions
        async function loadCaseProgress() {
            try {
                const response = await fetch('/api/client-portal/case-progress');
                const data = await response.json();

                if (data.success) {
                    renderCaseProgressOverview(data.progress);
                } else {
                    document.getElementById('caseProgressOverview').innerHTML = 
                        '<p style="color: #6b7280; text-align: center; padding: 1rem;">No progress data available</p>';
                }
            } catch (error) {
                console.error('Error loading case progress:', error);
                document.getElementById('caseProgressOverview').innerHTML = 
                    '<p style="color: #dc2626; text-align: center; padding: 1rem;">Error loading progress</p>';
            }
        }

        function renderCaseProgressOverview(progress) {
            const progressOverview = document.getElementById('caseProgressOverview');
            
            progressOverview.innerHTML = `
                <div class="progress-overview">
                    <div class="progress-header">
                        <div class="progress-title">${progress.current_phase.name}</div>
                        <div class="progress-percentage">${progress.case_info.overall_progress}%</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${progress.case_info.overall_progress}%"></div>
                    </div>
                    <div class="progress-phase">
                        <span class="current-phase">${progress.current_phase.description}</span>
                        <span class="phase-status">${progress.current_phase.progress}% complete</span>
                    </div>
                </div>
                
                ${progress.recent_progress.slice(0, 2).map(milestone => `
                    <div class="milestone-item completed">
                        <div class="milestone-icon completed">‚úì</div>
                        <div class="milestone-info">
                            <div class="milestone-title">${milestone.milestone}</div>
                            <div class="milestone-description">${milestone.description}</div>
                            <div class="milestone-date">${formatDate(milestone.date)}</div>
                        </div>
                    </div>
                `).join('')}
                
                ${progress.upcoming_milestones.slice(0, 1).map(milestone => `
                    <div class="milestone-item upcoming">
                        <div class="milestone-icon upcoming">‚è≥</div>
                        <div class="milestone-info">
                            <div class="milestone-title">${milestone.milestone}</div>
                            <div class="milestone-description">${milestone.description}</div>
                            <div class="milestone-date">${formatDate(milestone.date)}</div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        async function viewDetailedProgress() {
            const modal = document.getElementById('progressModal');
            const loading = document.getElementById('progressLoading');
            const timelineHeader = document.getElementById('timelineHeader');
            const timelinePhases = document.getElementById('timelinePhases');
            
            // Show modal and loading state
            modal.style.display = 'block';
            loading.style.display = 'block';
            timelineHeader.style.display = 'none';
            timelinePhases.style.display = 'none';
            
            try {
                const [progressResponse, milestonesResponse] = await Promise.all([
                    fetch('/api/client-portal/case-progress'),
                    fetch('/api/client-portal/case-progress/milestones')
                ]);
                
                const progressData = await progressResponse.json();
                const milestonesData = await milestonesResponse.json();

                if (progressData.success && milestonesData.success) {
                    renderDetailedTimeline(progressData.progress, milestonesData.milestones);
                } else {
                    timelinePhases.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading timeline</p>';
                }
            } catch (error) {
                console.error('Error loading detailed progress:', error);
                timelinePhases.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading timeline</p>';
            } finally {
                loading.style.display = 'none';
                timelineHeader.style.display = 'block';
                timelinePhases.style.display = 'block';
            }
        }

        function renderDetailedTimeline(progress, milestones) {
            const timelineHeader = document.getElementById('timelineHeader');
            const timelinePhases = document.getElementById('timelinePhases');
            
            // Render timeline header
            timelineHeader.innerHTML = `
                <div class="timeline-header">
                    <div class="timeline-case-title">${progress.case_info.title}</div>
                    <div style="color: rgba(255, 255, 255, 0.9); font-size: 0.875rem;">
                        ${progress.case_info.case_type} ‚Ä¢ ${progress.case_info.attorney}
                    </div>
                    <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.75rem; margin-top: 0.5rem;">
                        Started: ${formatDate(progress.case_info.start_date)} ‚Ä¢ 
                        Est. Completion: ${formatDate(progress.case_info.estimated_completion)}
                    </div>
                    <div class="timeline-progress-bar">
                        <div class="timeline-progress-fill" style="width: ${progress.case_info.overall_progress}%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 0.5rem; font-weight: 600;">
                        ${progress.case_info.overall_progress}% Complete
                    </div>
                </div>
            `;
            
            // Render phases and milestones
            timelinePhases.innerHTML = milestones.phases.map(phase => `
                <div class="phase-section">
                    <div class="phase-header ${phase.status}">
                        <div class="phase-status-icon ${phase.status}">
                            ${getPhaseStatusIcon(phase.status)}
                        </div>
                        <div class="phase-info">
                            <div class="phase-name">${phase.name}</div>
                            <div class="phase-description">${phase.status === 'completed' ? 'Completed' : phase.status === 'in_progress' ? 'In Progress' : 'Upcoming'}</div>
                            <div class="phase-dates">
                                ${formatDate(phase.start_date)} - ${formatDate(phase.end_date)}
                            </div>
                        </div>
                        <div style="margin-left: auto; font-weight: 600; color: inherit;">
                            ${phase.progress}%
                        </div>
                    </div>
                    
                    <div class="milestones-grid">
                        ${phase.milestones.map(milestone => `
                            <div class="milestone-card ${milestone.status}">
                                <div class="milestone-card-header">
                                    <div class="milestone-type-icon">
                                        ${getMilestoneTypeIcon(milestone.type)}
                                    </div>
                                    <div class="milestone-card-title">${milestone.title}</div>
                                </div>
                                <div class="milestone-card-description">${milestone.description}</div>
                                <div class="milestone-card-meta">
                                    <span class="milestone-card-date">${formatDate(milestone.date)}</span>
                                    <span class="milestone-status-badge ${milestone.status}">${milestone.status}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getPhaseStatusIcon(status) {
            const icons = {
                'completed': '‚úì',
                'in_progress': '‚è≥',
                'upcoming': '‚óã'
            };
            return icons[status] || '‚óã';
        }

        function getMilestoneTypeIcon(type) {
            const icons = {
                'meeting': 'ü§ù',
                'document': 'üìÑ',
                'court_filing': '‚öñÔ∏è',
                'court_appearance': 'üèõÔ∏è',
                'evaluation': 'üìä',
                'review': 'üîç',
                'scheduling': 'üìÖ'
            };
            return icons[type] || 'üìã';
        }

        function closeProgressModal() {
            document.getElementById('progressModal').style.display = 'none';
        }

        // Appointment Management Functions
        let selectedDate = '';
        let selectedTime = '';
        let availableSlots = [];

        async function loadUpcomingAppointments() {
            try {
                const response = await fetch('/api/client-portal/appointments');
                const data = await response.json();

                if (data.success) {
                    renderUpcomingAppointments(data.appointments.upcoming_appointments.slice(0, 2));
                } else {
                    document.getElementById('upcomingAppointments').innerHTML = 
                        '<p style="color: #6b7280; text-align: center; padding: 1rem;">No upcoming appointments</p>';
                }
            } catch (error) {
                console.error('Error loading upcoming appointments:', error);
                document.getElementById('upcomingAppointments').innerHTML = 
                    '<p style="color: #dc2626; text-align: center; padding: 1rem;">Error loading appointments</p>';
            }
        }

        function renderUpcomingAppointments(appointments) {
            const upcomingAppointments = document.getElementById('upcomingAppointments');
            
            if (appointments.length === 0) {
                upcomingAppointments.innerHTML = 
                    '<p style="color: #6b7280; text-align: center; padding: 1rem;">No upcoming appointments</p>';
                return;
            }

            upcomingAppointments.innerHTML = appointments.map(appt => `
                <div class="appointment-item upcoming">
                    <div class="appointment-icon">
                        ${getAppointmentTypeIcon(appt.type)}
                    </div>
                    <div class="appointment-info">
                        <div class="appointment-title">${appt.title}</div>
                        <div class="appointment-details">${appt.attorney} ‚Ä¢ ${appt.duration} min</div>
                        <div class="appointment-time">${formatDate(appt.date)} ‚Ä¢ ${appt.location}</div>
                    </div>
                    <div class="appointment-status ${appt.status}">${appt.status}</div>
                </div>
            `).join('');
        }

        async function viewAllAppointments() {
            const modal = document.getElementById('appointmentsModal');
            const loading = document.getElementById('appointmentsLoading');
            const appointmentsList = document.getElementById('appointmentsList');
            
            // Show modal and loading state
            modal.style.display = 'block';
            loading.style.display = 'block';
            appointmentsList.style.display = 'none';
            
            try {
                const response = await fetch('/api/client-portal/appointments');
                const data = await response.json();

                if (data.success) {
                    renderAllAppointments(data.appointments);
                    loadAppointmentTypes(data.appointments.appointment_types);
                    setupDateHandler();
                } else {
                    appointmentsList.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading appointments</p>';
                }
            } catch (error) {
                console.error('Error loading appointments:', error);
                appointmentsList.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 2rem;">Error loading appointments</p>';
            } finally {
                loading.style.display = 'none';
                appointmentsList.style.display = 'block';
            }
        }

        function renderAllAppointments(appointments) {
            const appointmentsList = document.getElementById('appointmentsList');
            
            const allAppointments = [
                ...appointments.upcoming_appointments,
                ...appointments.past_appointments
            ];
            
            if (allAppointments.length === 0) {
                appointmentsList.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 2rem;">No appointments found</p>';
                return;
            }

            appointmentsList.innerHTML = allAppointments.map(appt => {
                const isUpcoming = appointments.upcoming_appointments.includes(appt);
                return `
                    <div class="appointment-card ${isUpcoming ? 'upcoming' : 'past'}" onclick="selectAppointment('${appt.id}')">
                        <div class="appointment-card-header">
                            <div>
                                <div class="appointment-card-title">${appt.title}</div>
                                <div class="appointment-card-meta">
                                    <span>${formatDate(appt.date)}</span>
                                    <span>${appt.attorney}</span>
                                    <span>${appt.location}</span>
                                </div>
                            </div>
                            <div class="appointment-status ${appt.status}">${appt.status}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAppointmentTypes(types) {
            const appointmentType = document.getElementById('appointmentType');
            appointmentType.innerHTML = '<option value="">Select appointment type</option>' +
                types.map(type => 
                    `<option value="${type.id}">${type.name} (${type.duration} min)</option>`
                ).join('');
        }

        function setupDateHandler() {
            const dateInput = document.getElementById('appointmentDate');
            const typeSelect = document.getElementById('appointmentType');
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
            
            dateInput.addEventListener('change', function() {
                if (this.value && typeSelect.value) {
                    loadAvailableSlots(this.value);
                }
            });
            
            typeSelect.addEventListener('change', function() {
                if (this.value && dateInput.value) {
                    loadAvailableSlots(dateInput.value);
                }
            });
        }

        async function loadAvailableSlots(date) {
            const slotsContainer = document.getElementById('availableSlots');
            slotsContainer.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 1rem;">Loading available times...</p>';
            
            try {
                const response = await fetch('/api/client-portal/appointments/available-slots');
                const data = await response.json();
                
                if (data.success) {
                    availableSlots = data.available_slots.filter(slot => slot.date === date);
                    renderAvailableSlots(availableSlots);
                }
            } catch (error) {
                console.error('Error loading available slots:', error);
                slotsContainer.innerHTML = '<p style="color: #dc2626; text-align: center; padding: 1rem;">Error loading available times</p>';
            }
        }

        function renderAvailableSlots(slots) {
            const slotsContainer = document.getElementById('availableSlots');
            
            if (slots.length === 0) {
                slotsContainer.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 1rem;">No available times for this date</p>';
                return;
            }
            
            slotsContainer.innerHTML = slots.map(slot => `
                <div class="time-slot ${slot.available ? '' : 'unavailable'}" 
                     onclick="${slot.available ? `selectTimeSlot('${slot.time}')` : ''}"
                     data-time="${slot.time}">
                    ${slot.time}
                </div>
            `).join('');
        }

        function selectTimeSlot(time) {
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Add selection to clicked slot
            event.currentTarget.classList.add('selected');
            selectedTime = time;
            
            // Enable schedule button
            const scheduleButton = document.getElementById('scheduleButton');
            scheduleButton.disabled = false;
        }

        async function scheduleAppointment() {
            const appointmentType = document.getElementById('appointmentType').value;
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentNotes = document.getElementById('appointmentNotes').value;
            
            if (!appointmentType || !appointmentDate || !selectedTime) {
                alert('Please select appointment type, date, and time');
                return;
            }
            
            const scheduleButton = document.getElementById('scheduleButton');
            scheduleButton.disabled = true;
            scheduleButton.textContent = 'Scheduling...';
            
            try {
                const response = await fetch('/api/client-portal/appointments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: appointmentType,
                        date: appointmentDate,
                        time: selectedTime,
                        notes: appointmentNotes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Appointment scheduled successfully! You will receive a confirmation email shortly.');
                    
                    // Reset form
                    document.getElementById('appointmentType').value = '';
                    document.getElementById('appointmentDate').value = '';
                    document.getElementById('appointmentNotes').value = '';
                    document.getElementById('availableSlots').innerHTML = '';
                    selectedTime = '';
                    
                    // Refresh appointments and dashboard
                    viewAllAppointments();
                    loadUpcomingAppointments();
                } else {
                    alert('Error: ' + (data.error || 'Failed to schedule appointment'));
                }
            } catch (error) {
                console.error('Error scheduling appointment:', error);
                alert('Error scheduling appointment. Please try again.');
            } finally {
                scheduleButton.disabled = false;
                scheduleButton.textContent = 'Schedule Appointment';
            }
        }

        function selectAppointment(appointmentId) {
            // For now, just show appointment details
            // In a full implementation, this would show detailed view with actions
            console.log('Selected appointment:', appointmentId);
        }

        function getAppointmentTypeIcon(type) {
            const icons = {
                'consultation': 'üí¨',
                'document_review': 'üìÑ',
                'preparation': 'üìã',
                'strategy_session': 'üéØ'
            };
            return icons[type] || 'üìÖ';
        }

        function closeAppointmentsModal() {
            document.getElementById('appointmentsModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const documentsModal = document.getElementById('documentsModal');
            const messagesModal = document.getElementById('messagesModal');
            const progressModal = document.getElementById('progressModal');
            const appointmentsModal = document.getElementById('appointmentsModal');
            
            if (event.target === documentsModal) {
                closeDocumentsModal();
            }
            
            if (event.target === messagesModal) {
                closeMessagesModal();
            }
            
            if (event.target === progressModal) {
                closeProgressModal();
            }
            
            if (event.target === appointmentsModal) {
                closeAppointmentsModal();
            }
        }
    </script>
</body>
</html>