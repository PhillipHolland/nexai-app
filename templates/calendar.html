{% extends "base.html" %}

{% block title %}Calendar & Scheduling - LexAI Practice Partner{% endblock %}

{% block extra_head %}
    <style>
        /* Calendar Specific Styles */
        .calendar-container {
            background-color: #F7EDDA; /* light-cream */
            min-height: calc(100vh - 4rem);
            padding: 2rem 0;
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .calendar-title {
            font-size: 3rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
            line-height: 1.1;
        }

        .calendar-subtitle {
            font-size: 1.25rem;
            color: #6b7280;
            max-width: 32rem;
            margin: 0 auto 2rem;
        }

        .calendar-main {
            max-width: 1280px;
            margin: 0 auto;
            padding: 3rem 1rem;
        }

        /* Calendar Controls */
        .calendar-controls {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn {
            background: linear-gradient(135deg, #2E4B3C, #4a7c59);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 75, 60, 0.3);
        }

        .current-month {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            min-width: 200px;
            text-align: center;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            background: #f3f4f6;
            border-radius: 0.75rem;
            padding: 0.25rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            color: #6b7280;
        }

        .view-btn.active {
            background: #2E4B3C;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2E4B3C, #4a7c59);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 75, 60, 0.3);
            text-decoration: none;
            color: white;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
            text-decoration: none;
            color: #374151;
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
            text-decoration: none;
            color: white;
        }

        /* Calendar Layout */
        .calendar-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        /* Calendar Grid */
        .calendar-grid {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .calendar-grid-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .calendar-grid-header div {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: #374151;
            border-right: 1px solid #e5e7eb;
        }

        .calendar-grid-header div:last-child {
            border-right: none;
        }

        .calendar-grid-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 120px;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.5rem;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background-color: #f9fafb;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background-color: #f9fafb;
        }

        .calendar-day.today {
            background-color: #f0fdf4;
            border: 2px solid #2E4B3C;
        }

        .day-number {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .calendar-day.other-month .day-number {
            color: #9ca3af;
        }

        .calendar-day.today .day-number {
            color: #2E4B3C;
        }

        /* Week View */
        .week-view {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .week-header {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .week-header div {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: #374151;
            border-right: 1px solid #e5e7eb;
        }

        .week-header div:last-child {
            border-right: none;
        }

        .week-time-slot {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            border-bottom: 1px solid #f3f4f6;
            min-height: 60px;
        }

        .week-time {
            padding: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            border-right: 1px solid #e5e7eb;
        }

        .week-day-slot {
            border-right: 1px solid #e5e7eb;
            position: relative;
            padding: 0.25rem;
        }

        .week-day-slot:last-child {
            border-right: none;
        }

        /* Day View */
        .day-view {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .day-header {
            background: #f9fafb;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            text-align: center;
            font-weight: 600;
            color: #374151;
        }

        .day-time-slots {
            max-height: 600px;
            overflow-y: auto;
        }

        .day-time-slot {
            display: grid;
            grid-template-columns: 80px 1fr;
            border-bottom: 1px solid #f3f4f6;
            min-height: 60px;
        }

        .day-time {
            padding: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            border-right: 1px solid #e5e7eb;
        }

        .day-events {
            position: relative;
            padding: 0.25rem;
        }

        /* Events */
        .calendar-event {
            background: linear-gradient(135deg, #2E4B3C, #4a7c59);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .calendar-event:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(46, 75, 60, 0.3);
        }

        .calendar-event.court-date {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .calendar-event.client-meeting {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
        }

        .calendar-event.deadline {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
        }

        .calendar-event.consultation {
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
        }

        .calendar-event.deposition {
            background: linear-gradient(135deg, #0891b2, #0ea5e9);
        }

        .calendar-event.mediation {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .calendar-event.personal {
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
        }

        /* Sidebar */
        .calendar-sidebar {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        /* Quick Add Form */
        .quick-add-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quick-add-input {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .quick-add-input:focus {
            outline: none;
            border-color: #2E4B3C;
            box-shadow: 0 0 0 3px rgba(46, 75, 60, 0.1);
        }

        .quick-add-btn {
            background: linear-gradient(135deg, #2E4B3C, #4a7c59);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .quick-add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 75, 60, 0.3);
        }

        /* Event Filters */
        .event-filters {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            accent-color: #2E4B3C;
        }

        .filter-color {
            width: 16px;
            height: 16px;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
        }

        /* Upcoming Events */
        .upcoming-event {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upcoming-event:hover {
            background-color: #f9fafb;
        }

        .event-date {
            background: #2E4B3C;
            color: white;
            border-radius: 0.5rem;
            padding: 0.5rem;
            text-align: center;
            min-width: 60px;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .event-details {
            flex: 1;
        }

        .event-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .event-info {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .event-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .badge-court {
            background-color: #fee2e2;
            color: #dc2626;
        }

        .badge-client {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .badge-deadline {
            background-color: #fef3c7;
            color: #f59e0b;
        }

        .badge-consultation {
            background-color: #ede9fe;
            color: #7c3aed;
        }

        .badge-deposition {
            background-color: #e0f2fe;
            color: #0891b2;
        }

        .badge-mediation {
            background-color: #d1fae5;
            color: #059669;
        }

        /* Event Form Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2E4B3C;
            box-shadow: 0 0 0 3px rgba(46, 75, 60, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #2E4B3C;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .calendar-layout {
                grid-template-columns: 1fr;
            }
            
            .calendar-sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .calendar-title {
                font-size: 2rem;
            }

            .calendar-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .calendar-nav {
                justify-content: center;
            }

            .action-buttons {
                justify-content: center;
            }

            .calendar-day {
                min-height: 80px;
                font-size: 0.875rem;
            }

            .calendar-event {
                font-size: 0.625rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .week-header {
                grid-template-columns: 60px repeat(7, 1fr);
            }

            .week-time-slot {
                grid-template-columns: 60px repeat(7, 1fr);
            }

            .day-time-slot {
                grid-template-columns: 60px 1fr;
            }
        }

        /* Hidden by default */
        .hidden {
            display: none !important;
        }
    </style>
{% endblock %}

{% block content %}
<div class="calendar-container">
    <div class="calendar-main">
        <!-- Calendar Header -->
        <div class="calendar-header">
            <h1 class="calendar-title">📅 Calendar & Scheduling</h1>
            <p class="calendar-subtitle">Manage appointments, court dates, and schedule important meetings</p>
        </div>
        <!-- Calendar Controls -->
        <div class="calendar-controls">
            <div class="calendar-nav">
                <button class="nav-btn" onclick="previousPeriod()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                    Previous
                </button>
                <div class="current-month" id="currentPeriod">January 2025</div>
                <button class="nav-btn" onclick="nextPeriod()">
                    Next
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" onclick="setView('month')">Month</button>
                <button class="view-btn" onclick="setView('week')">Week</button>
                <button class="view-btn" onclick="setView('day')">Day</button>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="goToToday()">Today</button>
                <button class="btn btn-success" onclick="syncGoogleCalendar()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Sync Google Calendar
                </button>
                <button class="btn btn-primary" onclick="openEventModal()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 4v16m8-8H4"/>
                    </svg>
                    New Event
                </button>
            </div>
        </div>

        <!-- Calendar Layout -->
        <div class="calendar-layout">
            <!-- Main Calendar -->
            <div>
                <!-- Month View -->
                <div id="monthView" class="calendar-grid">
                    <div class="calendar-grid-header">
                        <div>Sunday</div>
                        <div>Monday</div>
                        <div>Tuesday</div>
                        <div>Wednesday</div>
                        <div>Thursday</div>
                        <div>Friday</div>
                        <div>Saturday</div>
                    </div>
                    <div class="calendar-grid-body" id="calendarBody">
                        <!-- Calendar days will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Week View -->
                <div id="weekView" class="week-view hidden">
                    <div class="week-header">
                        <div>Time</div>
                        <div id="weekDay0">Sun</div>
                        <div id="weekDay1">Mon</div>
                        <div id="weekDay2">Tue</div>
                        <div id="weekDay3">Wed</div>
                        <div id="weekDay4">Thu</div>
                        <div id="weekDay5">Fri</div>
                        <div id="weekDay6">Sat</div>
                    </div>
                    <div id="weekTimeSlots">
                        <!-- Time slots will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Day View -->
                <div id="dayView" class="day-view hidden">
                    <div class="day-header" id="dayHeader">
                        Today
                    </div>
                    <div class="day-time-slots" id="dayTimeSlots">
                        <!-- Time slots will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="calendar-sidebar">
                <!-- Quick Add -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Quick Add Event</h3>
                    <div class="quick-add-form">
                        <input type="text" id="quickTitle" class="quick-add-input" placeholder="Event title">
                        <input type="datetime-local" id="quickDateTime" class="quick-add-input">
                        <select id="quickType" class="quick-add-input">
                            <option value="general">General</option>
                            <option value="court-date">Court Date</option>
                            <option value="client-meeting">Client Meeting</option>
                            <option value="deadline">Deadline</option>
                            <option value="consultation">Consultation</option>
                            <option value="deposition">Deposition</option>
                            <option value="mediation">Mediation</option>
                        </select>
                        <button class="quick-add-btn" onclick="quickAddEvent()">Add Event</button>
                    </div>
                </div>

                <!-- Event Filters -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Event Filters</h3>
                    <div class="event-filters">
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('court-date')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #dc2626, #ef4444);"></div>
                            <span>Court Dates</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('client-meeting')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #2563eb, #3b82f6);"></div>
                            <span>Client Meetings</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('deadline')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);"></div>
                            <span>Deadlines</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('consultation')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6);"></div>
                            <span>Consultations</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('deposition')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #0891b2, #0ea5e9);"></div>
                            <span>Depositions</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('mediation')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #059669, #10b981);"></div>
                            <span>Mediation</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" checked onchange="toggleEventType('general')">
                            <div class="filter-color" style="background: linear-gradient(135deg, #2E4B3C, #4a7c59);"></div>
                            <span>General</span>
                        </label>
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Upcoming Events</h3>
                    <div id="upcomingEvents">
                        <!-- Upcoming events will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">This Week</h3>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280;">Court Dates</span>
                            <span style="font-weight: 600; color: #dc2626;" id="courtCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280;">Client Meetings</span>
                            <span style="font-weight: 600; color: #2563eb;" id="meetingCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280;">Deadlines</span>
                            <span style="font-weight: 600; color: #f59e0b;" id="deadlineCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280;">Available Hours</span>
                            <span style="font-weight: 600; color: #16a34a;" id="availableHours">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Modal -->
<div id="eventModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Add New Event</h2>
            <button class="close-btn" onclick="closeEventModal()">×</button>
        </div>

        <form id="eventForm">
            <div class="form-group">
                <label class="form-label" for="eventTitle">Event Title</label>
                <input type="text" id="eventTitle" class="form-input" placeholder="Enter event title" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="eventType">Event Type</label>
                <select id="eventType" class="form-select" required>
                    <option value="">Select Type</option>
                    <option value="court-date">Court Date</option>
                    <option value="client-meeting">Client Meeting</option>
                    <option value="deadline">Deadline</option>
                    <option value="deposition">Deposition</option>
                    <option value="mediation">Mediation</option>
                    <option value="consultation">Consultation</option>
                    <option value="general">General</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="eventDate">Date</label>
                    <input type="date" id="eventDate" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="eventTime">Time</label>
                    <input type="time" id="eventTime" class="form-input" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="eventDuration">Duration (hours)</label>
                    <input type="number" id="eventDuration" class="form-input" step="0.5" min="0.5" value="1">
                </div>
                <div class="form-group">
                    <label class="form-label" for="eventClient">Client</label>
                    <select id="eventClient" class="form-select" onchange="updateCaseOptions()">
                        <option value="">Select Client (Optional)</option>
                        <option value="abc-corp">ABC Corporation</option>
                        <option value="john-smith">John Smith</option>
                        <option value="jane-doe">Jane Doe</option>
                        <option value="tech-startup">Tech Startup Inc.</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="eventCase">Case</label>
                    <select id="eventCase" class="form-select">
                        <option value="">Select Case (Optional)</option>
                        <option value="case-1" data-client="john-smith">Smith v. Johnson</option>
                        <option value="case-2" data-client="abc-corp">Contract Dispute</option>
                        <option value="case-3" data-client="jane-doe">Estate Planning</option>
                        <option value="case-4" data-client="tech-startup">Corporate Formation</option>
                        <option value="case-5" data-client="john-smith">Personal Injury Claim</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="eventPriority">Priority</label>
                    <select id="eventPriority" class="form-select">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="eventLocation">Location</label>
                <input type="text" id="eventLocation" class="form-input" placeholder="Enter location (court, office, etc.)">
            </div>

            <div class="form-group">
                <label class="form-label" for="eventDescription">Description</label>
                <textarea id="eventDescription" class="form-textarea" placeholder="Add event details, notes, or agenda..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="eventReminder" style="margin-right: 0.5rem;">
                    Send reminder notifications
                </label>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <span id="saveButtonText">Save Event</span>
                    <div class="spinner hidden" id="saveSpinner"></div>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Calendar state
let currentDate = new Date();
let currentView = 'month';
let visibleEventTypes = new Set(['court-date', 'client-meeting', 'deadline', 'consultation', 'deposition', 'mediation', 'general']);
let events = [
    {
        id: 'court-1',
        title: 'Motion Hearing',
        type: 'court-date',
        date: '2025-01-15',
        time: '09:00',
        duration: 2,
        client: 'john-smith',
        case: 'case-1',
        location: 'Superior Court Room 3',
        description: 'Motion to dismiss hearing for Smith v. Jones case',
        priority: 'high'
    },
    {
        id: 'client-1',
        title: 'Client Meeting',
        type: 'client-meeting',
        date: '2025-01-16',
        time: '14:00',
        duration: 1.5,
        client: 'abc-corp',
        case: 'case-2',
        location: 'Conference Room A',
        description: 'Quarterly legal review meeting',
        priority: 'medium'
    },
    {
        id: 'deadline-1',
        title: 'Discovery Deadline',
        type: 'deadline',
        date: '2025-01-20',
        time: '17:00',
        duration: 0,
        client: 'jane-doe',
        case: 'case-3',
        location: '',
        description: 'Final deadline for discovery responses in Johnson case',
        priority: 'urgent'
    },
    {
        id: 'court-2',
        title: 'Trial',
        type: 'court-date',
        date: '2025-01-22',
        time: '09:30',
        duration: 8,
        client: 'tech-startup',
        case: 'case-4',
        location: 'Federal Court Room 5',
        description: 'Contract dispute trial - Day 1',
        priority: 'urgent'
    },
    {
        id: 'client-2',
        title: 'New Client Consultation',
        type: 'consultation',
        date: '2025-01-18',
        time: '10:00',
        duration: 1,
        client: '',
        case: '',
        location: 'Office',
        description: 'Initial consultation for potential IP case',
        priority: 'medium'
    },
    {
        id: 'depo-1',
        title: 'Witness Deposition',
        type: 'deposition',
        date: '2025-01-24',
        time: '13:00',
        duration: 3,
        client: 'john-smith',
        case: 'case-5',
        location: 'Law Office Conference Room',
        description: 'Deposition of key witness in personal injury case',
        priority: 'high'
    },
    {
        id: 'mediation-1',
        title: 'Settlement Mediation',
        type: 'mediation',
        date: '2025-01-26',
        time: '11:00',
        duration: 4,
        client: 'abc-corp',
        case: 'case-2',
        location: 'Mediation Center',
        description: 'Settlement mediation session',
        priority: 'high'
    }
];

document.addEventListener('DOMContentLoaded', function() {
    loadEvents();
    updateCalendarDisplay();
    updateUpcomingEvents();
    updateWeeklyStats();
    
    // Set quick add datetime to current time
    const now = new Date();
    const quickDateTime = document.getElementById('quickDateTime');
    quickDateTime.value = now.toISOString().slice(0, 16);
    
    // Event form submission
    document.getElementById('eventForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveEvent();
    });
});

// Load events from API
async function loadEvents() {
    try {
        const response = await fetch('/api/calendar/events');
        const data = await response.json();
        
        if (data.success) {
            events = data.events;
            updateCalendarDisplay();
            updateUpcomingEvents();
            updateWeeklyStats();
        }
    } catch (error) {
        console.error('Error loading events:', error);
        // Use demo events as fallback
    }
}

// Calendar navigation
window.previousPeriod = function() {
    if (currentView === 'month') {
        currentDate.setMonth(currentDate.getMonth() - 1);
    } else if (currentView === 'week') {
        currentDate.setDate(currentDate.getDate() - 7);
    } else if (currentView === 'day') {
        currentDate.setDate(currentDate.getDate() - 1);
    }
    updateCalendarDisplay();
};

window.nextPeriod = function() {
    if (currentView === 'month') {
        currentDate.setMonth(currentDate.getMonth() + 1);
    } else if (currentView === 'week') {
        currentDate.setDate(currentDate.getDate() + 7);
    } else if (currentView === 'day') {
        currentDate.setDate(currentDate.getDate() + 1);
    }
    updateCalendarDisplay();
};

window.goToToday = function() {
    currentDate = new Date();
    updateCalendarDisplay();
};

// View toggle
window.setView = function(view) {
    currentView = view;
    
    // Update active button
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show/hide views
    document.getElementById('monthView').classList.toggle('hidden', view !== 'month');
    document.getElementById('weekView').classList.toggle('hidden', view !== 'week');
    document.getElementById('dayView').classList.toggle('hidden', view !== 'day');
    
    updateCalendarDisplay();
};

// Update calendar display
function updateCalendarDisplay() {
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
    
    let periodText = '';
    if (currentView === 'month') {
        periodText = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        generateMonthView();
    } else if (currentView === 'week') {
        const weekStart = getWeekStart(currentDate);
        const weekEnd = getWeekEnd(currentDate);
        periodText = `Week of ${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;
        generateWeekView();
    } else if (currentView === 'day') {
        periodText = currentDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        generateDayView();
    }
    
    document.getElementById('currentPeriod').textContent = periodText;
}

// Generate month view
function generateMonthView() {
    const calendarBody = document.getElementById('calendarBody');
    calendarBody.innerHTML = '';
    
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    // First day of the month
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    // Generate 6 weeks (42 days)
    for (let i = 0; i < 42; i++) {
        const day = new Date(startDate);
        day.setDate(startDate.getDate() + i);
        
        const dayElement = createDayElement(day, month);
        calendarBody.appendChild(dayElement);
    }
}

// Generate week view
function generateWeekView() {
    const weekTimeSlots = document.getElementById('weekTimeSlots');
    weekTimeSlots.innerHTML = '';
    
    const weekStart = getWeekStart(currentDate);
    
    // Update day headers
    for (let i = 0; i < 7; i++) {
        const day = new Date(weekStart);
        day.setDate(weekStart.getDate() + i);
        const dayElement = document.getElementById(`weekDay${i}`);
        dayElement.innerHTML = `
            <div>${day.toLocaleDateString('en-US', { weekday: 'short' })}</div>
            <div style="font-size: 0.875rem;">${day.getDate()}</div>
        `;
    }
    
    // Generate time slots (8 AM to 8 PM)
    for (let hour = 8; hour <= 20; hour++) {
        const timeSlot = document.createElement('div');
        timeSlot.className = 'week-time-slot';
        
        const timeDiv = document.createElement('div');
        timeDiv.className = 'week-time';
        timeDiv.textContent = formatTime(hour);
        timeSlot.appendChild(timeDiv);
        
        for (let day = 0; day < 7; day++) {
            const daySlot = document.createElement('div');
            daySlot.className = 'week-day-slot';
            
            const currentDay = new Date(weekStart);
            currentDay.setDate(weekStart.getDate() + day);
            const dateStr = currentDay.toISOString().split('T')[0];
            
            // Add events for this hour and day
            const hourEvents = getFilteredEvents().filter(event => {
                const eventDate = new Date(event.date + 'T' + event.time);
                return event.date === dateStr && eventDate.getHours() === hour;
            });
            
            hourEvents.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = `calendar-event ${event.type}`;
                eventElement.textContent = event.title;
                eventElement.style.fontSize = '0.625rem';
                eventElement.onclick = (e) => {
                    e.stopPropagation();
                    viewEvent(event.id);
                };
                daySlot.appendChild(eventElement);
            });
            
            daySlot.onclick = () => openEventModal(dateStr, `${hour.toString().padStart(2, '0')}:00`);
            timeSlot.appendChild(daySlot);
        }
        
        weekTimeSlots.appendChild(timeSlot);
    }
}

// Generate day view
function generateDayView() {
    const dayTimeSlots = document.getElementById('dayTimeSlots');
    dayTimeSlots.innerHTML = '';
    
    const dayHeader = document.getElementById('dayHeader');
    dayHeader.textContent = currentDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    const dateStr = currentDate.toISOString().split('T')[0];
    
    // Generate time slots (8 AM to 8 PM)
    for (let hour = 8; hour <= 20; hour++) {
        const timeSlot = document.createElement('div');
        timeSlot.className = 'day-time-slot';
        
        const timeDiv = document.createElement('div');
        timeDiv.className = 'day-time';
        timeDiv.textContent = formatTime(hour);
        timeSlot.appendChild(timeDiv);
        
        const eventsDiv = document.createElement('div');
        eventsDiv.className = 'day-events';
        
        // Add events for this hour
        const hourEvents = getFilteredEvents().filter(event => {
            const eventDate = new Date(event.date + 'T' + event.time);
            return event.date === dateStr && eventDate.getHours() === hour;
        });
        
        hourEvents.forEach(event => {
            const eventElement = document.createElement('div');
            eventElement.className = `calendar-event ${event.type}`;
            eventElement.innerHTML = `
                <div style="font-weight: 600;">${event.title}</div>
                <div style="font-size: 0.625rem; opacity: 0.8;">${event.time} - ${event.location}</div>
            `;
            eventElement.onclick = (e) => {
                e.stopPropagation();
                viewEvent(event.id);
            };
            eventsDiv.appendChild(eventElement);
        });
        
        eventsDiv.onclick = () => openEventModal(dateStr, `${hour.toString().padStart(2, '0')}:00`);
        timeSlot.appendChild(eventsDiv);
        
        dayTimeSlots.appendChild(timeSlot);
    }
}

// Create day element for month view
function createDayElement(date, currentMonth) {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'calendar-day';
    
    const isToday = date.toDateString() === new Date().toDateString();
    const isOtherMonth = date.getMonth() !== currentMonth;
    
    if (isToday) dayDiv.classList.add('today');
    if (isOtherMonth) dayDiv.classList.add('other-month');
    
    // Day number
    const dayNumber = document.createElement('div');
    dayNumber.className = 'day-number';
    dayNumber.textContent = date.getDate();
    dayDiv.appendChild(dayNumber);
    
    // Events for this day
    const dateStr = date.toISOString().split('T')[0];
    const dayEvents = getFilteredEvents().filter(event => event.date === dateStr);
    
    dayEvents.forEach(event => {
        const eventElement = document.createElement('div');
        eventElement.className = `calendar-event ${event.type}`;
        eventElement.textContent = event.title;
        eventElement.onclick = (e) => {
            e.stopPropagation();
            viewEvent(event.id);
        };
        dayDiv.appendChild(eventElement);
    });
    
    // Click handler for day
    dayDiv.onclick = () => openEventModal(dateStr);
    
    return dayDiv;
}

// Helper functions
function getWeekStart(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day;
    return new Date(d.setDate(diff));
}

function getWeekEnd(date) {
    const d = getWeekStart(date);
    return new Date(d.setDate(d.getDate() + 6));
}

function formatTime(hour) {
    return hour === 12 ? '12:00 PM' : 
           hour > 12 ? `${hour - 12}:00 PM` : 
           `${hour}:00 AM`;
}

function getFilteredEvents() {
    return events.filter(event => visibleEventTypes.has(event.type));
}

// Event filtering
window.toggleEventType = function(type) {
    if (visibleEventTypes.has(type)) {
        visibleEventTypes.delete(type);
    } else {
        visibleEventTypes.add(type);
    }
    updateCalendarDisplay();
};

// Quick add event
window.quickAddEvent = function() {
    const title = document.getElementById('quickTitle').value;
    const dateTime = document.getElementById('quickDateTime').value;
    const type = document.getElementById('quickType').value;
    
    if (!title || !dateTime) {
        alert('Please fill in all required fields');
        return;
    }
    
    const date = dateTime.split('T')[0];
    const time = dateTime.split('T')[1];
    
    const newEvent = {
        id: 'quick-' + Date.now(),
        title: title,
        type: type,
        date: date,
        time: time,
        duration: 1,
        client: '',
        case: '',
        location: '',
        description: 'Quick added event',
        priority: 'medium'
    };
    
    events.push(newEvent);
    updateCalendarDisplay();
    updateUpcomingEvents();
    updateWeeklyStats();
    
    // Clear form
    document.getElementById('quickTitle').value = '';
    document.getElementById('quickDateTime').value = new Date().toISOString().slice(0, 16);
    document.getElementById('quickType').value = 'general';
    
    // Save to API
    saveEventToAPI(newEvent);
};

// Update upcoming events
function updateUpcomingEvents() {
    const upcomingContainer = document.getElementById('upcomingEvents');
    upcomingContainer.innerHTML = '';
    
    const now = new Date();
    const upcomingEvents = events
        .filter(event => new Date(event.date + 'T' + event.time) > now)
        .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time))
        .slice(0, 5);
    
    upcomingEvents.forEach(event => {
        const eventDiv = document.createElement('div');
        eventDiv.className = 'upcoming-event';
        eventDiv.onclick = () => viewEvent(event.id);
        
        const eventDate = new Date(event.date);
        const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN',
            'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        
        eventDiv.innerHTML = `
            <div class="event-date">
                <div>${eventDate.getDate()}</div>
                <div style="font-size: 0.75rem;">${monthNames[eventDate.getMonth()]}</div>
            </div>
            <div class="event-details">
                <div class="event-title">${event.title}</div>
                <div class="event-info">${event.time} - ${event.location}</div>
                <div class="event-type-badge badge-${event.type.replace('-', '')}">${event.type.replace('-', ' ')}</div>
            </div>
        `;
        
        upcomingContainer.appendChild(eventDiv);
    });
    
    if (upcomingEvents.length === 0) {
        upcomingContainer.innerHTML = '<p style="color: #6b7280; text-align: center;">No upcoming events</p>';
    }
}

// Update weekly stats
function updateWeeklyStats() {
    const now = new Date();
    const weekStart = getWeekStart(now);
    const weekEnd = getWeekEnd(now);
    
    const weekEvents = events.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate >= weekStart && eventDate <= weekEnd;
    });
    
    const courtCount = weekEvents.filter(e => e.type === 'court-date').length;
    const meetingCount = weekEvents.filter(e => e.type === 'client-meeting').length;
    const deadlineCount = weekEvents.filter(e => e.type === 'deadline').length;
    
    // Calculate available hours (assuming 8 hour workday, 5 days a week)
    const totalHours = 40;
    const bookedHours = weekEvents.reduce((sum, event) => sum + (event.duration || 1), 0);
    const availableHours = Math.max(0, totalHours - bookedHours);
    
    document.getElementById('courtCount').textContent = courtCount;
    document.getElementById('meetingCount').textContent = meetingCount;
    document.getElementById('deadlineCount').textContent = deadlineCount;
    document.getElementById('availableHours').textContent = availableHours;
}

// Google Calendar sync
window.syncGoogleCalendar = function() {
    const btn = event.target;
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></div> Syncing...';
    btn.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert('Google Calendar sync completed successfully!');
    }, 2000);
};

// Event modal functions
window.openEventModal = function(date = null, time = null) {
    if (date) {
        document.getElementById('eventDate').value = date;
    } else {
        document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
    }
    
    if (time) {
        document.getElementById('eventTime').value = time;
    } else {
        document.getElementById('eventTime').value = '09:00';
    }
    
    document.getElementById('eventModal').classList.remove('hidden');
};

window.closeEventModal = function() {
    document.getElementById('eventModal').classList.add('hidden');
    document.getElementById('eventForm').reset();
};

// Update case options based on selected client
function updateCaseOptions() {
    const clientSelect = document.getElementById('eventClient');
    const caseSelect = document.getElementById('eventCase');
    const selectedClient = clientSelect.value;
    
    // Reset case options
    caseSelect.innerHTML = '<option value="">Select Case (Optional)</option>';
    
    // Get all case options
    const allCases = [
        { value: 'case-1', text: 'Smith v. Johnson', client: 'john-smith' },
        { value: 'case-2', text: 'Contract Dispute', client: 'abc-corp' },
        { value: 'case-3', text: 'Estate Planning', client: 'jane-doe' },
        { value: 'case-4', text: 'Corporate Formation', client: 'tech-startup' },
        { value: 'case-5', text: 'Personal Injury Claim', client: 'john-smith' }
    ];
    
    // Filter cases by selected client
    const filteredCases = selectedClient ? 
        allCases.filter(case_ => case_.client === selectedClient) : 
        allCases;
    
    // Add filtered cases to dropdown
    filteredCases.forEach(case_ => {
        const option = document.createElement('option');
        option.value = case_.value;
        option.textContent = case_.text;
        option.setAttribute('data-client', case_.client);
        caseSelect.appendChild(option);
    });
}

// Save event
async function saveEvent() {
    const saveBtn = document.querySelector('#eventForm button[type="submit"]');
    const saveButtonText = document.getElementById('saveButtonText');
    const saveSpinner = document.getElementById('saveSpinner');
    
    saveButtonText.classList.add('hidden');
    saveSpinner.classList.remove('hidden');
    saveBtn.disabled = true;
    
    const formData = {
        title: document.getElementById('eventTitle').value,
        type: document.getElementById('eventType').value,
        date: document.getElementById('eventDate').value,
        time: document.getElementById('eventTime').value,
        duration: parseFloat(document.getElementById('eventDuration').value),
        client: document.getElementById('eventClient').value,
        case: document.getElementById('eventCase').value,
        priority: document.getElementById('eventPriority').value,
        location: document.getElementById('eventLocation').value,
        description: document.getElementById('eventDescription').value,
        reminder: document.getElementById('eventReminder').checked
    };

    try {
        const response = await fetch('/api/calendar/events', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            const newEvent = {
                id: data.event_id || 'event-' + Date.now(),
                ...formData
            };
            
            events.push(newEvent);
            updateCalendarDisplay();
            updateUpcomingEvents();
            updateWeeklyStats();
            closeEventModal();
            
            alert('Event created successfully!');
        } else {
            alert('Failed to save event: ' + (data.error || 'Unknown error'));
        }
        
    } catch (error) {
        console.error('Error saving event:', error);
        
        // Save locally as fallback
        const newEvent = {
            id: 'event-' + Date.now(),
            ...formData
        };
        
        events.push(newEvent);
        updateCalendarDisplay();
        updateUpcomingEvents();
        updateWeeklyStats();
        closeEventModal();
        
        alert('Event saved locally. Please check your connection.');
    } finally {
        saveButtonText.classList.remove('hidden');
        saveSpinner.classList.add('hidden');
        saveBtn.disabled = false;
    }
}

// Save event to API
async function saveEventToAPI(event) {
    try {
        const response = await fetch('/api/calendar/events', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(event)
        });

        const data = await response.json();
        
        if (data.success) {
            // Update event with server ID
            const eventIndex = events.findIndex(e => e.id === event.id);
            if (eventIndex !== -1) {
                events[eventIndex].id = data.event_id;
            }
        }
    } catch (error) {
        console.error('Error saving event to API:', error);
    }
}

// View event details
window.viewEvent = function(eventId) {
    const event = events.find(e => e.id === eventId);
    if (event) {
        const eventDate = new Date(event.date + 'T' + event.time);
        alert(`Event: ${event.title}\n` +
              `Type: ${event.type.replace('-', ' ')}\n` +
              `Date: ${eventDate.toLocaleDateString()}\n` +
              `Time: ${eventDate.toLocaleTimeString()}\n` +
              `Duration: ${event.duration} hour(s)\n` +
              `Location: ${event.location}\n` +
              `Priority: ${event.priority}\n` +
              `Description: ${event.description}`);
    }
};

// Close modal when clicking outside
document.getElementById('eventModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeEventModal();
    }
});

// Initialize calendar on page load
document.addEventListener('DOMContentLoaded', function() {
    updateCalendarDisplay();
    updateUpcomingEvents();
    updateWeeklyStats();
});
</script>
{% endblock %}